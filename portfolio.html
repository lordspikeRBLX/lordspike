<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LordSpike - Portfolio</title>
  <meta name="description" content="LordSpike — Music portfolio and SFX commissions" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0d1322;          /* brighter */
      --card:#151c2d;        /* brighter cards */
      --accent:#8fb1ff;      /* lighter accent */
      --accent2:#b7d7ff;
      --text:#f2f6ff;        /* brighter text */
      --muted:#b9c3da;       /* lighter muted */
      --ring:rgba(143,177,255,.40);
      --field:#0f1627;       /* inputs */
      --border:rgba(255,255,255,.10);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%, #1a2542 0%, rgba(26,37,66,0) 60%),
        radial-gradient(900px 600px at 110% 10%, #22355e 0%, rgba(34,53,94,0) 60%),
        linear-gradient(180deg, #0d1322, #111831 45%, #0c1224);
      overflow-x:hidden
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:22px}

    /* header */
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:48px;height:48px;border-radius:50%;background:#111;overflow:hidden;flex:0 0 auto;box-shadow:0 0 0 2px #12141b, 0 0 0 6px rgba(255,255,255,0.06)}
    .logo img{width:100%;height:100%;object-fit:cover;display:block}
    .title{font-weight:800;letter-spacing:.3px}
    .title small{display:block;color:var(--muted);font-weight:400}
    .cta-wrap{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:8px 12px;border-radius:12px;background:linear-gradient(180deg, #1a2448, #141d3a);color:var(--text);border:1px solid var(--border);box-shadow:0 0 0 0 var(--ring);transition:transform .2s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;display:inline-flex;align-items:center;gap:8px;font-weight:600}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px -6px rgba(0,0,0,.6), 0 0 0 6px var(--ring);border-color:rgba(143,177,255,.35)}
    .btn.accent{background:linear-gradient(180deg, #2a3e7a, #1a2755);border-color:#2b4386}

    /* sections */
    .hero{display:grid;grid-template-columns:1.05fr .95fr;gap:16px;align-items:stretch}
    @media (max-width:980px){.hero{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;position:relative;overflow:hidden;animation:cardIn .35s ease both}
    .card::after{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;box-shadow:inset 0 1px 0 rgba(255,255,255,.08)}
    .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .muted{color:var(--muted)}
    .about h1{margin:2px 0;font-size:28px;line-height:1.1}
    .about p{margin:6px 0 10px;color:var(--muted)}
    .rate-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:8px 0 2px}
    .pill{background:var(--field);border:1px solid var(--border);border-radius:12px;padding:10px 12px}
    .pill b{color:var(--accent)}

    /* ratings in info (compact) */
    .ratings-info{display:flex;align-items:center;gap:10px;margin:8px 0 6px}
    .stars-wrap{position:relative;display:inline-block;font-size:16px;line-height:1;letter-spacing:1px}
    .stars-base{color:#344267}
    .stars-fill{position:absolute;left:0;top:0;white-space:nowrap;overflow:hidden;color:var(--accent);transition:width .25s ease}
    .rating-meta{color:var(--muted);font-size:13px}

    /* previews — cozy */
    .previews-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:10px}
    .audio-card{display:grid;grid-template-columns:auto 1fr;grid-template-rows:auto auto auto;grid-template-areas:"btn name" "btn sub" "prog prog";gap:8px;align-items:center;padding:12px;border-radius:14px;background:var(--field);border:1px solid var(--border);transition:transform .15s ease, box-shadow .15s ease}
    .audio-card:hover{transform:translateY(-1px);box-shadow:0 8px 28px -10px rgba(0,0,0,.6)}
    .play-logo{grid-area:btn; width:38px;height:38px;border:none;border-radius:50%;display:grid;place-items:center;cursor:pointer;position:relative;overflow:hidden;background:radial-gradient(300px 200px at 50% -40%, rgba(143,177,255,.3), transparent 60%),linear-gradient(180deg,#2a3e7a,#1a2755);box-shadow:0 4px 18px -8px rgba(143,177,255,.55);transition:transform .2s ease}
    .play-logo img{width:22px;height:22px;display:block;filter:drop-shadow(0 1px 2px rgba(0,0,0,.4))}
    .play-logo:active{transform:scale(.96)}
    .play-logo.playing::after{content:"";position:absolute;inset:0;box-shadow:0 0 0 4px var(--ring);border-radius:50%}
    .name-line{grid-area:name;display:flex;align-items:center;gap:6px;flex-wrap:wrap}
    .track-name{font-weight:700}
    .badge{font-size:11px;padding:2px 7px;border-radius:999px;background:rgba(143,177,255,.15);border:1px solid rgba(143,177,255,.35);color:var(--text)}
    .subtitle{grid-area:sub;color:var(--muted);font-size:12.5px}
    .timeline{grid-area:prog;width:100%;height:4px;background:#0e1730;border-radius:999px;position:relative;overflow:hidden;border:1px solid var(--border)}
    .bar{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .12s linear}
    .time{font-size:12px;color:var(--muted);font-variant-numeric:tabular-nums;margin-left:6px}

    /* comments */
    .comments-wrap{display:grid;gap:8px}
    .comment-form.compact{display:grid;grid-template-columns:auto auto 1fr auto;gap:8px;align-items:center}
    .pfp-label{cursor:pointer}
    .pfp-logo{width:32px;height:32px;border-radius:50%;background:#12182b;border:1px solid var(--border);overflow:hidden;display:grid;place-items:center;transition:transform .2s ease}
    .pfp-logo img{width:100%;height:100%;object-fit:cover;display:block}
    .pfp-logo:active{transform:scale(.95)}
    .comment-form input,.comment-form textarea,.comment-form select{background:var(--field);border:1px solid var(--border);border-radius:10px;padding:7px 9px;color:var(--text);font:inherit}
    .comment-form .name{max-width:150px}
    .comment-form .title{min-width:0}
    .comment-form .desc{grid-column:1/-1}
    .comment-form textarea{resize:none} /* remove manual resizing */
    .tiny{font-size:12px;color:var(--muted)}
    .post-btn{height:30px;padding:0 10px;border-radius:10px;border:1px solid var(--border);background:#2a3e7a;color:var(--text);font-weight:700;cursor:pointer;transition:transform .2s ease}
    .post-btn:active{transform:scale(.97)}

    .comment-list{max-height:320px;overflow:auto;display:grid;gap:8px}
    .comment-empty{color:var(--muted);text-align:center;padding:16px;border:1px dashed var(--border);border-radius:10px}
    .comment{display:grid;grid-template-columns:auto 1fr auto;gap:8px;align-items:flex-start;padding:10px;border-radius:12px;background:var(--field);border:1px solid var(--border);animation:fade .25s ease both}
    .pfp{width:36px;height:36px;border-radius:50%;background:#12182b;color:#a9b6d8;display:grid;place-items:center;font-weight:800;border:1px solid var(--border);overflow:hidden}
    .pfp img{width:100%;height:100%;object-fit:cover;display:block}
    .c-meta{display:flex;align-items:center;gap:8px}
    .c-name{font-weight:700}
    .c-title{font-weight:700}
    .c-desc{color:var(--muted);font-size:12.5px;margin-top:3px}
    .stars{font-variant-numeric:tabular-nums;white-space:nowrap}

    @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
    @keyframes cardIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

    footer{opacity:.9;margin-top:22px;color:var(--muted);display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .small{font-size:12.5px}
  
    /* make previews scroll inside the card without altering card look */
    .previews-card{display:flex;flex-direction:column;min-height:0}
    .previews{overflow-y:auto;max-height:min(60vh, 520px);padding-right:2px}

</style>
</head>
<body>
  <div class="container">
    <header class="topbar">
      <a class="brand" href="#">
        <div class="logo"><img src="commission2.png" alt="LordSpike Logo"></div>
        <div class="title">LordSpike - Portfolio<small>Music • SFX • Game Audio</small></div>
      </a>
      <div class="cta-wrap">
        <a class="btn accent" href="https://discord.gg/5hwajx3jPY" target="_blank" rel="noopener">Discord</a>
        <a class="btn" href="https://mail.google.com/mail/?view=cm&fs=1&to=lorddspike@gmail.com" target="_blank" rel="noopener">Contact Email</a>
      </div>
    </header>

    <main class="hero">
      <!-- left: about + prices + ratings summary moved here -->
      <section class="card about">
        <div class="card-header"><h2>Info</h2><span class="muted">About & Rates</span></div>
        <div class="ratings-info">
          <div class="stars-wrap">
            <div class="stars-base">★★★★★</div>
            <div class="stars-fill" id="infoStarsFill" style="width:0%">★★★★★</div>
          </div>
          <div class="rating-meta"><span id="infoAvgText">0.0</span> · <span id="infoCountText">0</span> reviews</div>
        </div>
        <h1>Hello There! I'm LordSpike.</h1>
        <p>I'm a growing artist with over 3 years of experience who can make songs for your game!</p>
        <div class="rate-grid">
          <div class="pill"><b>Music</b><br> Robux: 2,500R$ / min • USD: $20 / min</div>
          <div class="pill"><b>SFX</b><br> Robux: 500R$ / each • USD: $5 / each</div>
        </div>
        <ul class="list">
          <li> SFX made in an app (not recorded real sounds) are harder — I make fully custom electronic SFX tailored to your game.</li>
          <li> Payment accepted in Robux or USD.</li>
          <li> Fast, clean communication via Discord or Email.</li>
        </ul>
      </section>

      <!-- right: cozy previews -->
      
      <section class="card previews-card">
        <div class="previews-head"><h2>Previews</h2></div>
        <div class="cards previews">
          <article class="audio-card" data-src="assets/Preview(5).mp3">
            <button class="play-logo" aria-label="Play"><img src="https://icons.veryicon.com/png/o/miscellaneous/icon-library-of-grey-sun/play-on-video.png" alt="play"></button>
            <div class="name-line">
              <span class="track-name">Eternal Hunger</span>
              <span class="badge">Dreamy</span>
              <span class="badge">Ambient</span>
              <span class="time">0:00</span>
            </div>
            <div class="subtitle">OST For a space game.</div>
            <div class="timeline" aria-label="Progress"><div class="bar"></div></div>
          </article>
          <article class="audio-card" data-src="assets/preview1.mp3">
            <button class="play-logo" aria-label="Play"><img src="https://icons.veryicon.com/png/o/miscellaneous/icon-library-of-grey-sun/play-on-video.png" alt="play"></button>
            <div class="name-line">
              <span class="track-name">Tidal</span>
              <span class="badge">Cartoony</span>
              <span class="badge">Dreamy</span>
              <span class="time">0:00</span>
            </div>
            <div class="subtitle">Simple Cartoony Song. </div>
            <div class="timeline" aria-label="Progress"><div class="bar"></div></div>
          </article>
          <article class="audio-card" data-src="assets/preview2.mp3">
            <button class="play-logo" aria-label="Play"><img src="https://icons.veryicon.com/png/o/miscellaneous/icon-library-of-grey-sun/play-on-video.png" alt="play"></button>
            <div class="name-line">
              <span class="track-name">Glacier Haze</span>
              <span class="badge">Simulator</span>
              <span class="badge">Cartoony</span>
              <span class="time">0:00</span>
            </div>
            <div class="subtitle">Simulator style, Cartoony.</div>
            <div class="timeline" aria-label="Progress"><div class="bar"></div></div>
          </article>
          <article class="audio-card" data-src="assets/preview3.mp3">
            <button class="play-logo" aria-label="Play"><img src="https://icons.veryicon.com/png/o/miscellaneous/icon-library-of-grey-sun/play-on-video.png" alt="play"></button>
            <div class="name-line">
              <span class="track-name">Morning Sakura</span>
              <span class="badge">Anime</span>
              <span class="badge">Japanese</span>
              <span class="time">0:00</span>
            </div>
            <div class="subtitle">Ancient Japanese type of song.</div>
            <div class="timeline" aria-label="Progress"><div class="bar"></div></div>
          </article>
          <article class="audio-card" data-src="assets/Preview6.mp3">
            <button class="play-logo" aria-label="Play"><img src="https://icons.veryicon.com/png/o/miscellaneous/icon-library-of-grey-sun/play-on-video.png" alt="play"></button>
            <div class="name-line">
              <span class="track-name">Fires</span>
              <span class="badge">Village</span>
              <span class="badge">Ambient</span>
              <span class="time">0:00</span>
            </div>
            <div class="subtitle">Chill Village Style.</div>
            <div class="timeline" aria-label="Progress"><div class="bar"></div></div>
          </article>
        </div>
      </section>

    </main>
<!-- comments: compact form on top + strict auto moderation (ratings summary removed from here) -->
    <section class="card" style="margin-top:16px">
      <div class="card-header">
        <h2>Comments</h2>
        <div class="comment-actions">
          <button id="refreshBtn" class="btn">Refresh</button>
        </div>
      </div>
      <div class="comments-wrap">
        <form id="commentForm" class="comment-form compact" autocomplete="off">
          <label for="pfpFile" class="pfp-label" title="Upload avatar">
            <div class="pfp-logo"><img id="pfpPreview" src="https://www.pngplay.com/wp-content/uploads/8/Upload-Icon-Logo-PNG-Photos.png" alt="upload"></div>
          </label>
          <input id="pfpFile" type="file" accept="image/*" hidden />
          <input id="name" class="name" name="name" placeholder="Customer" maxlength="40" />
          <select id="stars" name="stars" title="Stars">
            <option value="5" selected>★★★★★</option>
            <option value="4">★★★★☆</option>
            <option value="3">★★★☆☆</option>
            <option value="2">★★☆☆☆</option>
            <option value="1">★☆☆☆☆</option>
            <option value="0">☆☆☆☆☆</option>
          </select>
          <input id="title" class="title" name="title" required maxlength="50" placeholder="Title" />
          <span class="tiny" id="titleCount">0/50</span>
          <textarea id="desc" class="desc" name="desc" maxlength="150" placeholder="Description (optional)"></textarea>
          <div class="tiny" style="justify-self:end" id="descCount">0/150</div>
          <button class="post-btn" type="submit">Post</button>
        </form>

        <div id="commentList" class="comment-list" aria-live="polite"></div>
      </div>
    </section>

    <footer class="small">
      <div>© <span id="y"></span> LordSpike</div>
      <div>Discord and Email above</div>
    </footer>
  </div>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // ===== Audio players (logo button) =====
    const players = [];
    function setupPlayer(card){
      const src = card.getAttribute('data-src');
      const btn = card.querySelector('.play-logo');
      const bar = card.querySelector('.bar');
      const time = card.querySelector('.time');
      const audio = new Audio(src);
      audio.preload = 'metadata';

      function fmt(s){ s=Math.max(0,Math.floor(s||0)); const m=Math.floor(s/60), ss=String(s%60).padStart(2,'0'); return `${m}:${ss}`; }
      const raf = ()=>{ const p=audio.duration?(audio.currentTime/audio.duration):0; bar.style.width = `${p*100}%`; time.textContent = fmt(audio.currentTime); if(!audio.paused) requestAnimationFrame(raf); };

      btn.addEventListener('click', ()=>{
        players.forEach(p=>{ if(p.audio!==audio){ p.audio.pause(); p.btn.classList.remove('playing'); } });
        if(audio.paused){ audio.play().catch(()=>{}); btn.classList.add('playing'); requestAnimationFrame(raf); }
        else{ audio.pause(); btn.classList.remove('playing'); }
      });
      audio.addEventListener('ended', ()=>{ btn.classList.remove('playing'); bar.style.width='0%'; time.textContent='0:00'; });
      const tl = card.querySelector('.timeline');
      tl.addEventListener('click', e=>{ const r=tl.getBoundingClientRect(); const p=(e.clientX-r.left)/r.width; if(audio.duration){ audio.currentTime=Math.max(0,Math.min(1,p))*audio.duration; requestAnimationFrame(raf); } });
      players.push({audio, btn});
    }
    document.querySelectorAll('.audio-card').forEach(setupPlayer);

    // ===== Comments (localStorage) + strict auto purge =====
    const KEY = 'ls_portfolio_comments';
    const listEl = document.getElementById('commentList');
    const form = document.getElementById('commentForm');
    const refreshBtn = document.getElementById('refreshBtn');

    // profanity / slur filter (strict) — includes substring trigger like "nig"
    const BASIC = ['fuck','shit','bitch','asshole','dick','pussy','cunt','whore','slut'];
    // build sensitive slurs without writing literally
    const NWORD = String.fromCharCode(110,105,103,103,101,114);
    const NWORD_A = String.fromCharCode(110,105,103,103,97);
    const FSLUR = String.fromCharCode(102,97,103,103,111,116);
    const KSLUR = String.fromCharCode(107,105,107,101);
    const CSLUR = String.fromCharCode(99,104,105,110,107);
    const TSLUR = String.fromCharCode(116,114,97,110,110,121);
    const SENSITIVE = [NWORD,NWORD_A,FSLUR,KSLUR,CSLUR,TSLUR];
    const SUBSTR = ['nig']; // explicit substring rule per request

    const leetMap = {'0':'o','1':'i','3':'e','4':'a','5':'s','7':'t','8':'b','@':'a','$':'s'};
    function normalize(s){
      let t = (s||'').toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'');
      t = t.replace(/[\W_]+/g,'');
      t = t.replace(/[0134578@$]/g, ch=> leetMap[ch] || ch);
      return t;
    }
    function hasBadWords(...fields){
      const n = normalize(fields.join(' '));
      if (SUBSTR.some(w => n.includes(w))) return true;
      return BASIC.some(w => n.includes(w)) || SENSITIVE.some(w => n.includes(w));
    }

    function load(){
      try{ return JSON.parse(localStorage.getItem(KEY)||'[]'); }catch{ return []; }
    }
    function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

    function scrub(){
      let items = load();
      // exact timestamp purge: 2025-09-17 17:15:28 (local)
      const targetSec = Math.floor(new Date('2025-09-17T17:15:28').getTime()/1000);
      const before = items.length;
      items = items.filter(it => Math.floor(it.ts/1000) !== targetSec);
      // profanity/slur purge
      items = items.filter(it => !hasBadWords(it.name, it.title, it.desc));
      if(items.length !== before){ save(items); }
      return items;
    }

    // ratings summary (in Info)
    const infoStarsFill = document.getElementById('infoStarsFill');
    const infoAvgText = document.getElementById('infoAvgText');
    const infoCountText = document.getElementById('infoCountText');
    function updateSummary(items){
      const n = items.length;
      if(!n){ infoStarsFill.style.width = '0%'; infoAvgText.textContent = '0.0'; infoCountText.textContent = '0'; return; }
      const sum = items.reduce((a,b)=> a + (parseInt(b.stars,10)||0), 0);
      const avg = sum / n;
      infoStarsFill.style.width = `${(avg/5)*100}%`;
      infoAvgText.textContent = avg.toFixed(1);
      infoCountText.textContent = String(n);
    }

    function render(){
      const items = scrub();
      listEl.innerHTML = '';
      updateSummary(items);
      if(!items.length){
        const empty = document.createElement('div');
        empty.className = 'comment-empty';
        empty.textContent = 'Oops... No comments yet!';
        listEl.appendChild(empty);
        return;
      }
      items.slice().reverse().forEach(it=>{
        const row = document.createElement('div');
        row.className = 'comment';
        // pfp (uploaded or initial)
        const pfp = document.createElement('div');
        pfp.className = 'pfp';
        if(it.pfp){
          const img = document.createElement('img');
          img.src = it.pfp; img.alt = 'pfp';
          pfp.appendChild(img);
        }else{
          pfp.textContent = (it.name||'Customer').charAt(0).toUpperCase();
        }
        const body = document.createElement('div');
        const meta = document.createElement('div'); meta.className='c-meta';
        const name = document.createElement('div'); name.className='c-name'; name.textContent = it.name||'Customer';
        const stars = document.createElement('div'); stars.className='stars'; stars.textContent = `${'★'.repeat(it.stars)}${'☆'.repeat(5-it.stars)}`;
        meta.appendChild(name); meta.appendChild(stars);
        const title = document.createElement('div'); title.className='c-title'; title.textContent = it.title;
        const desc = document.createElement('div'); desc.className='c-desc'; desc.textContent = it.desc||'';
        body.appendChild(meta); body.appendChild(title); body.appendChild(desc);
        const right = document.createElement('div'); right.style.color='var(--muted)'; right.style.fontSize='12px'; right.textContent = new Date(it.ts).toLocaleString();
        row.appendChild(pfp); row.appendChild(body); row.appendChild(right);
        listEl.appendChild(row);
      });
    }

    // counters
    const titleEl = document.getElementById('title');
    const descEl = document.getElementById('desc');
    const titleCount = document.getElementById('titleCount');
    const descCount = document.getElementById('descCount');
    const updateCounts = ()=>{ titleCount.textContent = `${titleEl.value.length}/50`; descCount.textContent = `${descEl.value.length}/150`; };
    titleEl.addEventListener('input', updateCounts);
    descEl.addEventListener('input', updateCounts);
    updateCounts();

    // PFP upload + preview (scaled)
    let pfpDataURL = '';
    const pfpFile = document.getElementById('pfpFile');
    const pfpPreview = document.getElementById('pfpPreview');
    pfpFile.addEventListener('change', async (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) { pfpDataURL=''; pfpPreview.src='https://www.pngplay.com/wp-content/uploads/8/Upload-Icon-Logo-PNG-Photos.png'; return; }
      const img = new Image();
      const reader = new FileReader();
      reader.onload = ()=>{ img.src = reader.result; };
      reader.readAsDataURL(file);
      img.onload = ()=>{
        const size = 96; // small
        const c = document.createElement('canvas');
        c.width = size; c.height = size;
        const ctx = c.getContext('2d');
        ctx.fillStyle = '#12182b'; ctx.fillRect(0,0,size,size);
        const r = Math.min(size/img.width, size/img.height);
        const w = img.width*r, h = img.height*r;
        const x = (size - w)/2, y = (size - h)/2;
        ctx.drawImage(img, x, y, w, h);
        pfpDataURL = c.toDataURL('image/jpeg', 0.85);
        pfpPreview.src = pfpDataURL;
      };
    });

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const name = (form.name?.value||'').trim() || 'Customer';
      const title = (titleEl.value||'').trim().slice(0,50);
      const desc = (descEl.value||'').trim().slice(0,150);
      const stars = Math.max(0, Math.min(5, parseInt(document.getElementById('stars').value||'0',10)));
      if(!title) { titleEl.focus(); return; }
      if(hasBadWords(name, title, desc)){
        titleEl.value=''; descEl.value=''; updateCounts();
        return; // silently drop
      }
      const items = load();
      items.push({name, pfp: pfpDataURL, title, desc, stars, ts: Date.now()});
      save(items);
      form.reset(); pfpDataURL=''; pfpPreview.src='https://www.pngplay.com/wp-content/uploads/8/Upload-Icon-Logo-PNG-Photos.png'; updateCounts();
      render();
    });

    refreshBtn.addEventListener('click', render);
    render();
  </script>

<script>
/*
  6-hour comment cooldown (invisible).
  - Stores last send timestamp in localStorage.
  - Blocks submits on any form whose id/class includes "comment" (case-insensitive).
  - If none found, tries to bind to the form that contains a textarea/input with placeholder/name/id including "comment".
  - No visible countdown; only a minimal alert if user tries early.
*/
(function(){
  const COOLDOWN_MS = 6 * 60 * 60 * 1000; // 6 hours
  const STORAGE_KEY = "comment_last_sent_at";

  function findCommentForm(){
    const forms = Array.from(document.querySelectorAll("form"));
    // 1) any form tagged as comment by id/class
    const f1 = forms.find(f => (f.id + " " + f.className).toLowerCase().includes("comment"));
    if (f1) return f1;

    // 2) form that contains a textarea/input with "comment"
    for (const f of forms){
      const hit = f.querySelector('textarea, input[type="text"], input[type="search"], input[type="email"], input[type="url"]');
      if (!hit) continue;
      const txt = ((hit.id||"") + " " + (hit.name||"") + " " + (hit.placeholder||"")).toLowerCase();
      if (txt.includes("comment")) return f;
    }

    // 3) last fallback: if there's only one form on the page, use it (better than nothing)
    if (forms.length === 1) return forms[0];
    return null;
  }

  function msToHMin(ms){
    const totalMin = Math.ceil(ms/60000);
    const h = Math.floor(totalMin/60);
    const m = totalMin % 60;
    return {h, m};
  }

  function bind(){
    const form = findCommentForm();
    if (!form) return; // quietly bail out if no comment form exists

    form.addEventListener("submit", function(e){
      try {
        const now = Date.now();
        const last = parseInt(localStorage.getItem(STORAGE_KEY) || "0", 10);
        const left = COOLDOWN_MS - (now - last);

        if (last && left > 0){
          const {h, m} = msToHMin(left);
          // No visible countdown; just notify once when they try early.
          alert(`you can post again in ${h}h ${m}m`);
          e.preventDefault();
          e.stopPropagation();
          return false;
        }

        // allow submit, set stamp
        localStorage.setItem(STORAGE_KEY, String(now));
      } catch(err){
        // if any storage errors, just allow submit; fail-open
        console.warn("cooldown err:", err);
      }
    }, true);
  }

  if (document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", bind);
  } else {
    bind();
  }
})();
</script>

</body>
</html>
